---
title: C语言程序设计部分2
tags:
  - C语言

---

# C语言程序设计

## 七、指针

### 1、地址与指针

通过地址能找到所需的变量单元，可以说，地址指向变量单元，因此，将地址形象化地称为**”指针”**。

#### 为什么要用指针？

指针解决了一些编程中基本的问题。

（1）指针的使用使得不同区域的代码可以轻易的共享内部数据。

（2）指针使得一些复杂的链接性的数据结构的构建成为可能。

（3）有些操作必须使用内存。如操作申请的堆内存。

#### 指针含义

指针是程序数据在内存中的地址，而指针变量是用来保存这些地址的变量。

**由于内存中的每个字节都有一个唯一的编号，因此，在程序中使用的变量，常量，甚至数函数等数据，当他们被载入到内存中后，都有自己唯一的一个编号，这个编号就是这个数据的地址。指针就是这样形成的。**

### 2、指针变量：定义和赋值、访问、参数和返回值

C语言中，定义变量时，在变量名 前 写一个 * 星号，这个变量就变成了对应变量类型的指针变量。必要时要加( ) 来避免优先级的问题。

**赋值：**

```c
int num=1;
int* p_num=&num;
特殊的情况，并不一定需要使用&取地址：
1、数组名的值就是这个数组的第一个元素的地址。
2、函数名的值就是这个函数的地址。
3、字符串字面值常量作为右值时，就是这个字符串对应的字符数组的名字，也就是这个字符串在内存中的地址。
```

```c
//实例
#include <stdio.h>
int main()
{
   int  var = 20;   /* 实际变量的声明 */
   int  *ip;        /* 指针变量的声明 */
   ip = &var;  /* 在指针变量中存储 var 的地址 */
   printf("Address of var variable: %p\n", &var  );
   /* 在指针变量中存储的地址 */
   printf("Address stored in ip variable: %p\n", ip );
   /* 使用指针访问值 */
   printf("Value of *ip variable: %d\n", *ip ); 
   return 0;
}
```

当上面的代码被编译和执行时，它会产生下列结果：

<img src="/assets/image/2020-08-10-8.jpg" style="zoom: 80%;" />

### 3、指针运算：指针与整数的加减、指针相减和比较、强制类型转换和void*指针、不合法的指针运算、指针类型与数组类型的差异

**加减：**

```c
#include <stdio.h>
const int MAX = 3;
int main ()
{
   int  var[] = {10, 100, 200};
   int  i, *ptr;
   /* 指针中的数组地址 */
   ptr = var;
   for ( i = 0; i < MAX; i++)
   {
 
      printf("存储地址：var[%d] = %x\n", i, ptr );
      printf("存储值：var[%d] = %d\n", i, *ptr );
      /* 移动到下一个位置 */
      ptr++;
   }
   return 0;
}
```

当上面的代码被编译和执行时，它会产生下列结果：

<img src="/assets/image/2020-08-10-9.jpg" style="zoom: 80%;" />

**比较：**

```c
#include <stdio.h>
const int MAX = 3;
int main ()
{
   int  var[] = {10, 100, 200};
   int  i, *ptr;
   /* 指针中第一个元素的地址 */
   ptr = var;
   i = 0;
   while ( ptr <= &var[MAX - 1] )
   {
      printf("Address of var[%d] = %p\n", i, ptr );
      printf("Value of var[%d] = %d\n", i, *ptr );
      /* 指向上一个位置 */
      ptr++;
      i++;
   }
   return 0;
}
```

当上面的代码被编译和执行时，他会产生下列结果：
<img src="/assets/image/2020-08-10-10.jpg" style="zoom: 80%;" />

**强制类型转换：**

指针类型强制转换：

```c
int m;
int* pm=&m;
char* cp=(char *)&m;
```

**void指针：**

- void *
- 可以用其指代任何类型的指针，但不能用void指针直接进行操作；只能转换成对应类型的指针后，才能操作

使用方式:

```c
enum Season{
    Spring,Summer=18,Autumn,Winter
}season;
enum Season *s=&season;
void* vs=s;
int* ns=(int*)vs;		//转换成对应的int型指针
printf("ns=%d\n",ns);
```

因其可以指代任何类型的指针。所以将void指针作为函数参数时，表示接受任何类型的指针参数

```c
void test(void* a){
    printf("void*-->%d\n",*(int*)a);
}
void main{
    int m=10;
    int *p=&m;
    test(p);
}
```

**不合法的指针运算：**

const常量指针不能做++（--），因为常量指针不能改变

**指针类型和数组类型的差异：**

（1）字符数组由若干个元素组成，每个元素中放一个字符，而字符指针变量中存放的是地址（字符串第一个字符的地址），绝不是将字符串放到字符指针变量中。

（2）赋值方式。可以对字符指针变量赋值，但不能对数组名赋值。

（3）初始化的含义。

```c
char* a="I love China!";	//定义字符指针变量a，并把字符串第一个元素的地址赋给a
char str[14]="I love China!";	//定义字符数组str，并把字符串赋给数组中各元素
```

（4）存储单元的内容。编译时为字符数组分配若干存储单元，以存放各元素的值，而对字符指针变量，只分配一个存储单元。

（5）指针变量的值是可以改变的，而字符数组名代表一个固定的值（数组首元素的地址），不能改变。

（6）字符数组中各元素的值是可以改变的（可以对它们再赋值），但字符指针变量指向的字符串常量中的内容是不可以被取代的（不能对他们再赋值）。

（7）引用数组元素，可以用下标法。引用指针元素，可以用地址法。

（8）用指针变量指向一个格式字符串，可以用它代替printf函数中的格式字符串。

例如：

```c
char* format;
format="a=%d,b=%f\n";
printf(format,a,b);
```
### 4、指针与数组

所谓数组元素的指针就是数组元素的地址。

```c
int a[10]={1,2,3,4,5,6,7,8,9,0};
int* p;
p=&a[0];	//把a[0]元素的地址赋给指针变量a
```

### 5、指向二维数组的指针、多重指针和指针数组

<img src="/assets/image/2020-08-15-0.jpg" style="zoom: 80%;" />

### 6、函数指针

如果在程序中定义了一个函数，在编译时会把函数的源代码转换为可执行代码并分配一段存储空间。这段内存空间有一个起始地址，也成为函数的入口地址。每次调用函数时都从该地址入口开始执行此段函数代码。函数名代表函数的起始地址，调用函数时，从函数名得到函数的起始地址，并执行函数代码。

<img src="/assets/image/2020-08-15-1.jpg" style="zoom: 80%;" />

1. 定义指向函数的指针变量，并不意味着这个指针变量可以指向任何函数，它只能指向在定义时指定的类型的函数。
2. 如果要用指针调用函数，必须先使指针变量指向该函数。
3. 在给函数指针变量赋值时，只须给出函数名而不必给出参数。
4. 用函数指针变量调用函数时，只须将（*p）代替函数名即可，在（ *p）之后的括号中根据需要写上实参。
5. 对指向函数的指针变量不能进行算术运算。如p+n,p-n等运算都是无意义的。
6. 用函数名调用函数，只能调用所指定的一个函数，而通过指针变量调用函数比较灵活，可以根据不同情况先后调用不同的函数。

**返回指针值的函数：**

<img src="/assets/image/2020-08-15-2.jpg" style="zoom: 80%;" />
